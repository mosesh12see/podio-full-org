<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Org Stats - Closer App</title>
    <link rel="icon" type="image/png" sizes="180x180" href="full-org-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="full-org-icon.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            padding: 40px;
            color: #fff;
            zoom: 0.65;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        .header h1 {
            font-size: 4em;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.4em;
            opacity: 0.9;
        }

        .last-updated {
            text-align: center;
            opacity: 0.7;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 40px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 50px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 70px rgba(240, 147, 251, 0.5);
        }

        .stat-card h2 {
            font-size: 2.5em;
            margin-bottom: 35px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            border-bottom: 3px solid rgba(240, 147, 251, 0.5);
            padding-bottom: 20px;
        }

        .big-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 35px;
        }

        .big-stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
        }

        .big-stat .label {
            font-size: 1em;
            opacity: 0.7;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .big-stat .value {
            font-size: 3em;
            font-weight: bold;
            color: #4ade80;
        }

        .big-stat .value.money {
            color: #fbbf24;
        }

        .big-stat .value.revenue {
            color: #60a5fa;
        }

        .big-stat .value.spend {
            color: #f87171;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-row-label {
            font-size: 1.1em;
            opacity: 0.8;
        }

        .metric-row-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        .footer {
            text-align: center;
            margin-top: 60px;
            opacity: 0.6;
            font-size: 1em;
        }

        .footer p {
            margin: 8px 0;
        }

        /* Auto-refresh indicator */
        .refresh-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ FULL ORG STATS</h1>
            <p>Complete Closer App Performance Dashboard</p>
        </div>

        <div class="last-updated">
            Last Updated: October 25, 2025 at 01:18 PM
        </div>

        <div class="stats-grid">
            <!-- MTD Card -->
            <div class="stat-card">
                <h2>üìÜ MTD (Month to Date)</h2>

                <div class="big-stats">
                    <div class="big-stat">
                        <div class="label">Revenue</div>
                        <div class="value revenue">$1,471,360</div>
                    </div>
                    <div class="big-stat">
                        <div class="label">Spend</div>
                        <div class="value spend">$57,684</div>
                    </div>
                    <div class="big-stat">
                        <div class="label">Profit</div>
                        <div class="value money">$157,837</div>
                    </div>
                    <div class="big-stat">
                        <div class="label">Sit Rate</div>
                        <div class="value">53.9%</div>
                    </div>
                    <div class="big-stat">
                        <div class="label">Close Rate</div>
                        <div class="value">28.8%</div>
                    </div>
                    <div class="big-stat">
                        <div class="label">Total KW Sold</div>
                        <div class="value">267.52</div>
                    </div>
                </div>

                <div class="metric-row">
                    <span class="metric-row-label">Total Appointments</span>
                    <span class="metric-row-value">245</span>
                </div>
                <div class="metric-row">
                    <span class="metric-row-label">Sits</span>
                    <span class="metric-row-value">132</span>
                </div>
                <div class="metric-row">
                    <span class="metric-row-label">Closed Deals</span>
                    <span class="metric-row-value">38</span>
                </div>
            </div>

            <!-- WTD Card -->
            <div class="stat-card">
                <h2>üìÖ WTD (Week to Date)</h2>

                <div class="big-stats">
                    <div class="big-stat">
                        <div class="label">Revenue</div>
                        <div class="value revenue">$448,140</div>
                    </div>
                    <div class="big-stat">
                        <div class="label">Spend</div>
                        <div class="value spend">$10,488</div>
                    </div>
                    <div class="big-stat">
                        <div class="label">Profit</div>
                        <div class="value money">$48,073</div>
                    </div>
                    <div class="big-stat">
                        <div class="label">Sit Rate</div>
                        <div class="value">35.3%</div>
                    </div>
                    <div class="big-stat">
                        <div class="label">Close Rate</div>
                        <div class="value">37.5%</div>
                    </div>
                    <div class="big-stat">
                        <div class="label">Total KW Sold</div>
                        <div class="value">81.48</div>
                    </div>
                </div>

                <div class="metric-row">
                    <span class="metric-row-label">Total Appointments</span>
                    <span class="metric-row-value">68</span>
                </div>
                <div class="metric-row">
                    <span class="metric-row-label">Sits</span>
                    <span class="metric-row-value">24</span>
                </div>
                <div class="metric-row">
                    <span class="metric-row-label">Closed Deals</span>
                    <span class="metric-row-value">9</span>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>Full Organization Statistics</strong> | Podio Closer App</p>
            <p>MTD: 2025-10-01 to 2025-10-25 | WTD: 2025-10-20 to 2025-10-25</p>
            <p style="margin-top: 15px;">üí∞ Revenue: $5.50 per watt (KW √ó 1000 √ó $5.50)</p>
            <p>üí∏ Spend: $437 per sit (Sits √ó $437)</p>
            <p>üíµ Profit: $0.59 per watt (KW √ó 1000 √ó $0.59)</p>
            <p style="margin-top: 15px; opacity: 0.8;">Sit Rate = Sits √∑ Total Appointments | Close Rate = Closed √∑ Sits</p>
        </div>
    </div>

    <!-- Refresh Indicator -->
    <div class="refresh-indicator" id="refreshIndicator">Next refresh: Calculating...</div>

    <script>
        // ========== AUTO-REFRESH SCHEDULER ==========
        const REFRESH_TIMES = [
            { hour: 9, minute: 0 },   // 9:00 AM
            { hour: 12, minute: 0 },  // 12:00 PM
            { hour: 15, minute: 0 },  // 3:00 PM
            { hour: 18, minute: 0 },  // 6:00 PM
            { hour: 21, minute: 0 }   // 9:00 PM
        ];

        function getNextRefreshTime() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

            let nextRefresh = null;

            // Check today's refresh times
            for (const time of REFRESH_TIMES) {
                const refreshTime = new Date(today);
                refreshTime.setHours(time.hour, time.minute, 0, 0);

                if (refreshTime > now) {
                    nextRefresh = refreshTime;
                    break;
                }
            }

            // If no refresh time today, use first time tomorrow
            if (!nextRefresh) {
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(REFRESH_TIMES[0].hour, REFRESH_TIMES[0].minute, 0, 0);
                nextRefresh = tomorrow;
            }

            return nextRefresh;
        }

        function formatTime(date) {
            return date.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
        }

        function formatTimeUntil(ms) {
            const hours = Math.floor(ms / (1000 * 60 * 60));
            const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((ms % (1000 * 60)) / 1000);

            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else if (minutes > 0) {
                return `${minutes}m ${seconds}s`;
            } else {
                return `${seconds}s`;
            }
        }

        function updateRefreshIndicator() {
            const now = new Date();
            const nextRefresh = getNextRefreshTime();
            const timeUntil = nextRefresh - now;

            const indicator = document.getElementById('refreshIndicator');
            indicator.innerHTML = `Next refresh: ${formatTime(nextRefresh)}<br>Time until: ${formatTimeUntil(timeUntil)}`;

            // If it's time to refresh (within 5 seconds)
            if (timeUntil <= 5000 && timeUntil > 0) {
                indicator.innerHTML = `Refreshing in ${Math.ceil(timeUntil / 1000)}s...`;
            }

            if (timeUntil <= 0) {
                indicator.innerHTML = 'Refreshing now...';
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }

        // Update indicator every second
        setInterval(updateRefreshIndicator, 1000);
        updateRefreshIndicator();
    </script>

    <!-- METHODOLOGY SECTION -->
    <div style="background: white; border-radius: 13px; padding: 30px; margin-top: 30px; box-shadow: 0 9px 22px rgba(0,0,0,0.2);">
        <h2 style="color: #667eea; margin-bottom: 20px; font-size: 1.8em; border-bottom: 3px solid #667eea; padding-bottom: 10px;">
            üìä Methodology & Definitions
        </h2>

        <div style="line-height: 1.8; color: #2c3e50;">
            <h3 style="color: #764ba2; margin-top: 20px; margin-bottom: 10px;">What is Full Org Dashboard?</h3>
            <p style="margin-bottom: 15px;">
                The <strong>Full Org Dashboard</strong> tracks ALL appointments and sits across the entire organization,
                pulling data from Internal Apps in Podio. This dashboard provides organization-wide visibility into
                appointment activity, sit performance, and payment tracking.
            </p>

            <h3 style="color: #764ba2; margin-top: 25px; margin-bottom: 10px;">‚ö†Ô∏è IMPORTANT: Data Exclusions</h3>
            <div style="background: #fff5f5; padding: 20px; border-left: 4px solid #e74c3c; margin: 15px 0;">
                <p style="margin: 5px 0; font-weight: bold; color: #e74c3c;">The following appointments are EXCLUDED from all statistics:</p>
                <ul style="margin-left: 25px; margin-top: 10px;">
                    <li><strong>Chase AI Appointments:</strong> Any appointment where the closer, partner, or agent contains "chase"</li>
                    <li><strong>Infinite AI Appointments:</strong> Any appointment where set_by, agent, or partner contains "infinite" or "infinite ai"</li>
                </ul>
                <p style="margin-top: 15px; font-style: italic;">
                    <strong>Reason:</strong> These automated AI appointments are tracked separately and excluded to show
                    only Team Captain-generated appointments in the Full Org statistics.
                </p>
            </div>

            <h3 style="color: #764ba2; margin-top: 25px; margin-bottom: 10px;">Key Metrics Explained</h3>
            <ul style="margin-left: 25px; margin-bottom: 15px;">
                <li><strong>Total Appointments:</strong> All scheduled appointments (excluding Chase/Infinite AI)</li>
                <li><strong>Sits:</strong> Appointments where the customer was marked as "sat"</li>
                <li><strong>Sit Rate:</strong> Calculated as <code>(Total Sits / Total Appointments) √ó 100</code></li>
                <li><strong>Paid Sits:</strong> Sits where payment has been received</li>
                <li><strong>Unpaid Sits:</strong> Sits where payment is still owed</li>
                <li><strong>Not Paid %:</strong> Calculated as <code>(Unpaid Sits / Total Sits) √ó 100</code></li>
            </ul>

            <h3 style="color: #764ba2; margin-top: 25px; margin-bottom: 10px;">Payment Status Rules</h3>
            <div style="background: #f0fff4; padding: 15px; border-left: 4px solid #27ae60; margin: 15px 0;">
                <p style="margin: 5px 0;"><strong>This tracker uses DIFFERENT payment rules than other trackers:</strong></p>
                <ul style="margin-left: 25px; margin-top: 10px;">
                    <li>SPS = "NP" ‚Üí <strong>Not Paid</strong></li>
                    <li>SPS = "P" ‚Üí <strong>Paid</strong></li>
                    <li>SPS = Empty/Not Set ‚Üí <strong>PAID</strong> (via Google Sheets integration)</li>
                </ul>
                <p style="margin-top: 10px; font-style: italic; font-size: 0.95em;">
                    Note: Empty SPS field is treated as PAID because it's synced via Google Sheets as paid status.
                </p>
            </div>

            <h3 style="color: #764ba2; margin-top: 25px; margin-bottom: 10px;">Calculation Methods</h3>
            <ul style="margin-left: 25px; margin-bottom: 15px;">
                <li><strong>Monthly Totals:</strong> Appointments grouped by appointment date month</li>
                <li><strong>Team/Closer Performance:</strong> Metrics aggregated by closer name</li>
                <li><strong>State Breakdown:</strong> Geographic distribution of appointments</li>
                <li><strong>Appointment Status:</strong> Tracks confirmed, rescheduled, canceled, and no-show appointments</li>
            </ul>

            <h3 style="color: #764ba2; margin-top: 25px; margin-bottom: 10px;">Data Source</h3>
            <p style="margin-bottom: 15px;">
                Data is pulled from Podio Internal Apps via API. The exclusion logic for Chase AI and Infinite AI
                appointments is applied during data processing to ensure only Team Captain appointments are included
                in organizational statistics.
            </p>

            <p style="margin-top: 25px; font-size: 0.9em; color: #666; font-style: italic;">
                For detailed technical documentation, see <code>README_INTERNAL_FULL_ORG.md</code> and <code>full_org_return.py</code> (lines 305-321 for exclusion logic) in the project folder.
            </p>
        </div>
    </div>

</body>
</html>
